import*as d3 from"https://cdn.skypack.dev/d3@7.3.0";class CalendarHeatmap extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.template='\n        <style>\n          #heatmap {\n            padding-block: 1em;\n            overflow: auto;\n          }\n    \n          svg.calendar {\n            inline-size: max(56.25rem, 100%);\n          }\n        </style>\n    \n        <div id="heatmap" part="heatmap"></div>\n        '}get dataSrc(){return this.dataset.src}async getData(){const t=await fetch(this.dataSrc),e=await t.json();return new Map(e.map((t=>[t.date,t.time])))}async getDates(t){const e=[];for(const[a,n]of t)e.push(parseInt(a));return{start:Math.min.apply(null,e),end:Math.max.apply(null,e)+1}}async connectedCallback(){const{shadowRoot:t}=this;t.innerHTML=this.template;const e=await this.getData(),a=await this.getDates(e),n=17,r="currentColor",s="0.1px",d=d3.scaleQuantize().domain([0,23]).range(["#b1deff","#54b1f5","#0264a9","#002b4c"]),l=d3.select(t.querySelector("#heatmap")).selectAll("svg").data(d3.range(a.start,a.end)).enter().append("svg").attr("viewBox","0 0 960 136").attr("width","100%").attr("height","100%").attr("class","calendar").append("g").attr("transform","translate(29.5, 16)");l.append("g").attr("fill","none").attr("stroke",r).attr("stroke-width",s).selectAll("rect").data((t=>d3.timeDays(new Date(t,0,1),new Date(t+1,0,1)))).enter().append("rect").attr("class","day").attr("width",n).attr("height",n).attr("x",(t=>d3.timeWeek.count(d3.timeYear(t),t)*n)).attr("y",(t=>t.getDay()*n)).datum(d3.timeFormat("%Y-%m-%d")).attr("fill",(t=>d(parseInt(e.get(t)))));t.querySelectorAll(".day").forEach((t=>{t.hasAttribute("fill")&&d3.select(t).on("mouseover",(function(){d3.select(this).attr("stroke-width","1px")})).on("mouseout",(function(){d3.select(this).attr("stroke-width",s)})).append("title").text((t=>`Date: ${t}\nTime: ${e.get(t)}`))})),l.append("text").attr("transform","translate(-6, 59.5)rotate(-90)").attr("font-size","1rem").attr("text-anchor","middle").attr("fill",r).text((t=>t)),l.append("g").attr("fill","none").attr("stroke",r).attr("stroke-width","1.5px").selectAll("path").data((t=>d3.timeMonths(new Date(t,0,1),new Date(t+1,0,1)))).enter().append("path").attr("class","month").attr("d",(function(t){const e=new Date(t.getFullYear(),t.getMonth()+1,0),a=t.getDay(),r=d3.timeWeek.count(d3.timeYear(t),t),s=e.getDay(),d=d3.timeWeek.count(d3.timeYear(e),e);return`M${(r+1)*n}, ${a*n}H${r*n}V119H${d*n}V${(s+1)*n}H${(d+1)*n}V0H${(r+1)*n}Z`}));const i=d3.scaleBand().domain(["January","February","March","April","May","June","July","August","September","October","November","December"]).range([0,910]),o=d3.axisTop(i).tickSize(0).tickPadding("3");l.append("g").attr("id","x-axis").call(o).selectAll("path").attr("stroke","transparent")}}customElements.define("calendar-heatmap",CalendarHeatmap);